<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>票价管理</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!--<link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">-->
    <script src="js/jquery-1.11.0.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
</head>

<body>
    <div>
        <table class="table table-sm table-dark">
            <thead>
                <tr>
                    <th scope="col">序号</th>
                    <th scope="col">名称</th>
                    <th scope="col">价格（元）</th>
                    <th scope="col">颜色</th>
                </tr>
            </thead>
            <tbody id="priceBody">
                <!--<tr>
                    <th scope="row">1</th>
                    <td>一级票</td>
                    <td>99</td>
                    <td><input type="color" name="color" onchange="changeColorTd(this)"></td>
                </tr>
                <tr>
                    <th scope="row">2</th>
                    <td>二机票</td>
                    <td>88</td>
                    <td><input type="color" name="color" onchange="changeColorTd(this)"></td>
                </tr>
                <tr>
                </tr>-->
            </tbody>
        </table>
    </div>

    <div>
        <button onclick="addPrice()">添加价格</button>
        <button onclick="submitPrice()">保存</button>
    </div>

    <div id="priceForm">
        <div class="itemInput">
            价格类型：<input type="text" id="priceName" name="priceName">
        </div>
        <div class="itemInput">
            价格(元)：<input type="number" id="priceNum" name="priceNum">
        </div>
        <div class="itemInput">
            <input type="submit" onclick="submit()" style="margin-left: 50px;">
            <button style="margin-left: 120px;" onclick="quit()">取消</button>
        </div>

    </div>
    <!-- <input type="color" name="color" id="color" onchange="changeColor()"> //选择颜色的标签，type="color" -->
    <!-- <span id="colorInfo"></span> -->
</body>

<style type="text/css">
    #priceForm {
        display: none;
        opacity: 0.9;
        width: 500px;
        height: 300px;
        background-color: #999;
        z-index: 2;
        position: absolute;
        top: 100px;
        left: 500px;
    }

    .itemInput {
        margin-top: 49px;
        margin-left: 100px;
    }
</style>

<script type="text/javascript">

    let priceArr = [];
    $.ajax({
        url:"/price/all",
        type: "post",
        dataType: "json",
        contentType: "application/json",
        success: function (result) {
            console.log(result);
            priceArr = result ;
            for (let i = 0; i < priceArr.length; i++) {
                formContent(priceArr[i].name,priceArr[i].price,priceArr[i].color);
            }
        }
    })

    function changeColorTd(elem) {
        let trDom = elem.parentNode.parentNode;
        trDom.style.color = "white";
        trDom.style.backgroundColor = elem.value;
        let nameTd = trDom.children[1];
        console.log(nameTd.innerHTML)
        let checkedPriceArr = priceArr.filter(item => {
            if (item.name == nameTd.innerHTML) {
                return true
            }
        })

        checkedPriceArr[0].color = elem.value ;
    }

    function addPrice() {
        document.getElementById("priceForm").style.display = "block";
    }

    function submit() {
        document.getElementById("priceForm").style.display = "none";
        let name = $("#priceName").val();
        let num = $("#priceNum").val();
        let priceItem = {};
        priceItem.name = name;
        priceItem.price = num;
        priceArr.push(priceItem);
        formContent(name,num,null);
    }

    function formContent(name,num,color) {
        let trStyle = '<tr>' ;
        if(color!=null){
            trStyle = '<tr style="background-color: '+color+';color: white">'
        }
        let content = trStyle+
            '                    <th scope="row">#</th>' +
            '                    <td>' + name + '</td>' +
            '                    <td>' + num + '</td>' +
            '                    <td><input type="color" name="color" value="'+color+'" onchange="changeColorTd(this)"></td>' +
            '                </tr>';
        $("#priceBody").append(content);
    }

    function quit() {
        document.getElementById("priceForm").style.display = "none";
    }

    function submitPrice() {
        console.log(priceArr);
        $.ajax({
            url:"/price/add",
            type: "post",
            dataType: "json",
            contentType: "application/json",
            data: JSON.stringify(priceArr),
            success: function (result) {
                console.log(result); //  2pm
            }
        })
    }
</script>

</html>